database  <%= scope['::openldap::params::database'] %>
suffix    "<%= @basedn %>"
rootdn    "<%= @rootdn %>,<%= @basedn %>"
rootpw    "<%= @rootpw %>"
directory <%= scope['::openldap::params::vardir'] %>/<%= @name %>

index objectClass                       eq,pres
index ou,mail,surname,givenname         eq,pres,sub
index uidNumber,gidNumber,loginShell    eq,pres
index cn,uid,memberUid                  eq,pres,approx,sub
index nisMapName,nisMapEntry            eq,pres,sub

access to attrs=userPassword
    by self write
    by anonymous auth
<%- if @syncdn -%>
    by dn.base="<%= @syncdn %>,<%= @basedn %>" read
<%- end -%>
    by * none
access to *
    by self write
<%- if @syncdn -%>
    by dn.base="<%= @syncdn %>,<%= @basedn %>" read
<%- end -%>
<%- if @readdn -%>
    by dn.base="<%= @readdn %>,<%= @basedn %>" read
<%- end -%>
    by * <%= @anonymous_read ? 'read' : 'none' %>

